<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CivE265 Fall2025 - STL Gallery</title>

  <style>
    body { font-family: Arial, sans-serif; padding: 24px; background: #f0f0f0; margin:0; }
    h1 { text-align:center; margin: 18px 0 26px; }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 18px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: white;
      padding: 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease;
      border: 1px solid rgba(0,0,0,0.06);
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.12);
    }
    .thumb {
      width: 100%;
      height: 130px;           /* ✅ 比你160小，接近“最初版本”观感 */
      object-fit: cover;
      border-radius: 10px;
      background: #ddd;
      display:block;
    }
    .id-box{
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f7f7f7;
      border: 1px solid rgba(0,0,0,0.08);
      text-align: center;
      font-weight: 800;
      letter-spacing: 0.5px;
      font-size: 13px;
    }
    .title-box{
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f7f7f7;
      border: 1px solid rgba(0,0,0,0.08);
      text-align: center;
      font-weight: 700;
      font-size: 13px;
      line-height: 1.25;
      opacity: 0.92;
      word-break: break-word;
      min-height: 34px;        /* ✅ 让卡片高度更整齐 */
      display:flex;
      align-items:center;
      justify-content:center;
    }
  </style>
</head>

<body>
  <h1>CivE265 Fall2025 - Enjoy your amazing creativity</h1>

  <div class="gallery" id="gallery"></div>

  <script>
    const gallery = document.getElementById('gallery');

    function safePathId(id){
      // 文件名里有空格/特殊字符时，保证路径正确
      return encodeURIComponent(id);
    }

    async function loadText(url){
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
      return (await res.text()).trim();
    }

    function makeCard(id) {
      const div = document.createElement('div');
      div.className = 'card';
      div.onclick = () => location.href = `viewer.html?model=${encodeURIComponent(id)}`;

      const img = document.createElement('img');
      img.className = 'thumb';
      img.alt = `ID ${id}`;

      // thumbnail fallback: png -> jpg -> jpeg
      img.src = `thumbnails/${id}.png`;
      img.onerror = () => {
        if (img.dataset.triedJpg) return;
        img.dataset.triedJpg = "1";
        img.src = `thumbnails/${id}.jpg`;
        img.onerror = () => { img.src = `thumbnails/${id}.jpeg`; };
      };

      const idBox = document.createElement('div');
      idBox.className = 'id-box';
      idBox.textContent = id;

      const titleBox = document.createElement('div');
      titleBox.className = 'title-box';
      titleBox.textContent = "Loading title...";

      // ✅ 从 titles/<id>_title.txt 读取标题
      (async () => {
        try{
          const t = await loadText(`titles/${safePathId(id)}_title.txt`);
          titleBox.textContent = t || "(No title)";
          img.alt = t || `ID ${id}`;
        }catch(e){
          titleBox.textContent = "(No title)";
        }
      })();

      div.appendChild(img);
      div.appendChild(idBox);
      div.appendChild(titleBox);
      return div;
    }

    // ✅ 读取 ids.txt 自动生成卡片
    (async () => {
      try{
        const raw = await loadText("ids.txt");
        const ids = raw
          .split(/\r?\n/)
          .map(s => s.trim())
          .filter(Boolean);

        ids.forEach(id => gallery.appendChild(makeCard(id)));
      }catch(e){
        console.error(e);
        alert("Failed to load ids.txt. Make sure ids.txt is in the same folder as index.html");
      }
    })();
  </script>
</body>
</html>
